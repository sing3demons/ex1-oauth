# OAuth2 Flow Explanation (à¸à¸²à¸£à¸­à¸˜à¸´à¸šà¸²à¸¢ OAuth2)

## ðŸª à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸šà¸‡à¹ˆà¸²à¸¢à¹†: OAuth2 à¹€à¸«à¸¡à¸·à¸­à¸™à¸£à¹‰à¸²à¸™à¸ªà¸°à¸”à¸§à¸à¸‹à¸·à¹‰à¸­

### à¸•à¸±à¸§à¸¥à¸°à¸„à¸£:
- **ðŸ‘¤ à¸„à¸¸à¸“** = Resource Owner (à¹€à¸ˆà¹‰à¸²à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥)
- **ðŸ›’ à¹à¸­à¸›à¸ªà¸±à¹ˆà¸‡à¸­à¸²à¸«à¸²à¸£** = Client (à¹à¸­à¸›à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥)
- **ðŸ¦ à¸˜à¸™à¸²à¸„à¸²à¸£** = Authorization Server (à¸œà¸¹à¹‰à¹ƒà¸«à¹‰à¸ªà¸´à¸—à¸˜à¸´à¹Œ)
- **ðŸ’³ à¸£à¸°à¸šà¸šà¸ˆà¹ˆà¸²à¸¢à¹€à¸‡à¸´à¸™** = Resource Server (à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸£à¸´à¸‡)

### à¸à¸£à¸°à¸šà¸§à¸™à¸à¸²à¸£:

#### 1ï¸âƒ£ **à¸„à¸¸à¸“à¸ªà¸±à¹ˆà¸‡à¸­à¸²à¸«à¸²à¸£à¸œà¹ˆà¸²à¸™à¹à¸­à¸›**
```
à¹à¸­à¸›: "à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¸ˆà¹ˆà¸²à¸¢à¹€à¸‡à¸´à¸™à¸‚à¸­à¸‡à¸„à¸¸à¸“"
à¸„à¸¸à¸“: "à¸•à¸à¸¥à¸‡ à¹„à¸›à¸‚à¸­à¸ªà¸´à¸—à¸˜à¸´à¹Œà¸—à¸µà¹ˆà¸˜à¸™à¸²à¸„à¸²à¸£à¸à¹ˆà¸­à¸™"
```
**à¹ƒà¸™à¹‚à¸„à¹‰à¸”:**
```go
// client/main.go - initiateOAuth()
authURL := fmt.Sprintf("%s/oauth/authorize", serverURL)
ctx.Redirect(http.StatusFound, authURL)
```

#### 2ï¸âƒ£ **à¸„à¸¸à¸“à¹„à¸›à¸˜à¸™à¸²à¸„à¸²à¸£à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸ªà¸´à¸—à¸˜à¸´à¹Œ**
```
à¸˜à¸™à¸²à¸„à¸²à¸£: "à¹à¸­à¸›à¸ªà¸±à¹ˆà¸‡à¸­à¸²à¸«à¸²à¸£à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸”à¸¹à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™ à¸­à¸™à¸¸à¸à¸²à¸•à¸¡à¸±à¹‰à¸¢?"
à¸„à¸¸à¸“: "à¸­à¸™à¸¸à¸à¸²à¸• à¹à¸•à¹ˆà¹ƒà¸«à¹‰à¸”à¸¹à¹„à¸”à¹‰à¹à¸„à¹ˆà¸¢à¸­à¸”à¹€à¸‡à¸´à¸™ à¸«à¹‰à¸²à¸¡à¸–à¸­à¸™à¹€à¸‡à¸´à¸™"
à¸˜à¸™à¸²à¸„à¸²à¸£: "à¸™à¸µà¹ˆà¹ƒà¸šà¸­à¸™à¸¸à¸à¸²à¸•à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§ (authorization code) à¹€à¸­à¸²à¹„à¸›à¹ƒà¸«à¹‰à¹à¸­à¸›"
```
**à¹ƒà¸™à¹‚à¸„à¹‰à¸”:**
```go
// main.go - authHandler.Authorize()
oauth2.GET("/authorize", authHandler.Authorize)
```

#### 3ï¸âƒ£ **à¹à¸­à¸›à¹€à¸­à¸²à¹ƒà¸šà¸­à¸™à¸¸à¸à¸²à¸•à¹„à¸›à¹à¸¥à¸à¸šà¸±à¸•à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡**
```
à¹à¸­à¸›: "à¸™à¸µà¹ˆà¹ƒà¸šà¸­à¸™à¸¸à¸à¸²à¸•à¸ˆà¸²à¸à¸¥à¸¹à¸à¸„à¹‰à¸² à¸‚à¸­à¸šà¸±à¸•à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸™à¹ˆà¸­à¸¢"
à¸˜à¸™à¸²à¸„à¸²à¸£: "à¸™à¸µà¹ˆà¸šà¸±à¸•à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡ (access token) à¹ƒà¸Šà¹‰à¹„à¸”à¹‰ 1 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡"
```
**à¹ƒà¸™à¹‚à¸„à¹‰à¸”:**
```go
// main.go - authHandler.Token()
oauth2.POST("/token", authHandler.Token)
```

#### 4ï¸âƒ£ **à¹à¸­à¸›à¹ƒà¸Šà¹‰à¸šà¸±à¸•à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥**
```
à¹à¸­à¸›: "à¸™à¸µà¹ˆà¸šà¸±à¸•à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡ à¸‚à¸­à¸”à¸¹à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¸¹à¸à¸„à¹‰à¸²à¸«à¸™à¹ˆà¸­à¸¢"
à¸£à¸°à¸šà¸šà¸ˆà¹ˆà¸²à¸¢à¹€à¸‡à¸´à¸™: "à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸šà¸±à¸•à¸£à¹à¸¥à¹‰à¸§ à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ à¸™à¸µà¹ˆà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸‚à¸­"
```
**à¹ƒà¸™à¹‚à¸„à¹‰à¸”:**
```go
// à¸šà¸£à¸£à¸—à¸±à¸”à¸—à¸µà¹ˆà¸„à¸¸à¸“à¹€à¸¥à¸·à¸­à¸ - main.go
oauth2.GET("/profile", authHandler.UserInfo)
```

## ðŸ”’ à¸‚à¹‰à¸­à¸”à¸µà¸‚à¸­à¸‡ OAuth2:

### âœ… **à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢**
- à¹à¸­à¸›à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸ˆà¸£à¸´à¸‡à¸‚à¸­à¸‡à¸„à¸¸à¸“
- à¹„à¸”à¹‰à¹à¸„à¹ˆà¸šà¸±à¸•à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§

### âœ… **à¸„à¸§à¸šà¸„à¸¸à¸¡à¹„à¸”à¹‰**
- à¸„à¸¸à¸“à¹€à¸¥à¸·à¸­à¸à¹„à¸”à¹‰à¸§à¹ˆà¸²à¸ˆà¸°à¹ƒà¸«à¹‰à¸ªà¸´à¸—à¸˜à¸´à¹Œà¸­à¸°à¹„à¸£à¸šà¹‰à¸²à¸‡
- à¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸žà¸´à¸à¸–à¸­à¸™à¸ªà¸´à¸—à¸˜à¸´à¹Œà¹„à¸”à¹‰à¸•à¸¥à¸­à¸”à¹€à¸§à¸¥à¸²

### âœ… **à¸ªà¸°à¸”à¸§à¸**
- à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸šà¸±à¸à¸Šà¸µà¹ƒà¸«à¸¡à¹ˆà¹ƒà¸™à¸—à¸¸à¸à¹à¸­à¸›
- à¹ƒà¸Šà¹‰à¸šà¸±à¸à¸Šà¸µà¹€à¸”à¸´à¸¡à¸—à¸µà¹ˆà¸¡à¸µà¸­à¸¢à¸¹à¹ˆ

## ðŸ”„ OAuth2 Grant Types (à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¸‚à¸­à¸ªà¸´à¸—à¸˜à¸´à¹Œ):

### 1. **Authorization Code** (à¸—à¸µà¹ˆà¹€à¸£à¸²à¹ƒà¸Šà¹‰)
- à¹€à¸«à¸¡à¸²à¸°à¸ªà¸³à¸«à¸£à¸±à¸š web apps
- à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¸—à¸µà¹ˆà¸ªà¸¸à¸”

### 2. **Implicit**
- à¹€à¸«à¸¡à¸²à¸°à¸ªà¸³à¸«à¸£à¸±à¸š mobile apps
- à¹„à¸”à¹‰ token à¹‚à¸”à¸¢à¸•à¸£à¸‡

### 3. **Client Credentials**
- à¹€à¸«à¸¡à¸²à¸°à¸ªà¸³à¸«à¸£à¸±à¸š server-to-server
- à¹„à¸¡à¹ˆà¸¡à¸µà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹€à¸‚à¹‰à¸²à¸¡à¸²à¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡

### 4. **Password**
- à¹ƒà¸Šà¹‰ username/password à¹‚à¸”à¸¢à¸•à¸£à¸‡
- à¹€à¸«à¸¡à¸²à¸°à¸ªà¸³à¸«à¸£à¸±à¸š first-party apps

## ðŸ›¡ï¸ Security Features à¹ƒà¸™à¹‚à¸„à¹‰à¸”à¸‚à¸­à¸‡à¹€à¸£à¸²:

### **State Parameter**
```go
// client/main.go
state, err := generateState()
ctx.SetCookie("oauth_state", state, 600, "/", "", false, true)
```
- à¸›à¹‰à¸­à¸‡à¸à¸±à¸™ CSRF attacks

### **JWT Tokens**
```go
// internal/services/oauth_service.go
token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
tokenString, err := token.SignedString([]byte(s.jwtSecret))
```
- Token à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸›à¸¥à¸­à¸¡à¹à¸›à¸¥à¸‡à¹„à¸”à¹‰

### **Secure Cookie**
- httpOnly = true (à¸›à¹‰à¸­à¸‡à¸à¸±à¸™ XSS)
- Secure = true (à¹ƒà¸Šà¹‰à¹„à¸”à¹‰à¹à¸„à¹ˆ HTTPS)

## ðŸ“Š Flow Diagram:

```
ðŸ‘¤ User          ðŸ›’ Client App          ðŸ¦ Auth Server          ðŸ’¾ Resource Server
  |                    |                       |                        |
  |--- à¸‚à¸­à¹€à¸‚à¹‰à¸²à¹ƒà¸Šà¹‰ ------>|                       |                        |
  |                    |--- à¸‚à¸­à¸ªà¸´à¸—à¸˜à¸´à¹Œ --------->|                        |
  |<--- redirect ------|                       |                        |
  |                    |                       |                        |
  |--- login/authorize ------------------------>|                        |
  |                    |                       |                        |
  |                    |<-- auth code ---------|                        |
  |                    |                       |                        |
  |                    |--- à¹à¸¥à¸ token -------->|                        |
  |                    |<-- access token ------|                        |
  |                    |                       |                        |
  |                    |--- à¸‚à¸­à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (with token) ------------------>|
  |                    |<-- à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ ---------------------------|
  |<-- à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ -----|                       |                        |
```

## ðŸŽ¯ à¸ªà¸£à¸¸à¸›:
OAuth2 à¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰à¹à¸­à¸›à¸•à¹ˆà¸²à¸‡à¹† à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹„à¸”à¹‰à¸­à¸¢à¹ˆà¸²à¸‡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢ à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸«à¹‰à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸ˆà¸£à¸´à¸‡ à¹à¸¥à¸°à¸„à¸¸à¸“à¸ªà¸²à¸¡à¸²à¸£à¸–à¸„à¸§à¸šà¸„à¸¸à¸¡à¸ªà¸´à¸—à¸˜à¸´à¹Œà¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¹„à¸”à¹‰à¹€à¸•à¹‡à¸¡à¸—à¸µà¹ˆ!
